# ุงููุณุชุดูู ุงูุฎุงุฑู โ MVP (Polling + WhatsApp)

ูุฐุง ูุดุฑูุน ุฃููู (MVP) ุฌุงูุฒ ููุชุดุบูู ูุญูููุง: ููุฑุฃ ุชุญุฏูุซุงุช ูู ููู CSV ูููุฑุณู ุชูุจููุงุช ูุงุชุณุงุจ ููููุงูุจ ุงูุญุงูู ูู ูู ูุณู.

> **ุงููุณุชูู:** ุจุณูุท ุฌุฏูุง โ ุจุฏูู ุชูุงูู ูุน HIS.  
> **ุงูููุงุฉ:** WhatsApp ุนุจุฑ Twilio API (ูููู ุงุณุชุจุฏุงูู ุจู Meta Cloud ูุงุญููุง).

---

## ๐งฑ ุงูููููุงุช
- `poller.py`: ุณูุฑุจุช ุงููุฑุงุกุฉ ุงูุฏูุฑูุฉ ูููู `data/updates.csv`ุ ูููุฑุณู ุงูุฑุณุงุฆู ุงูููุงุณุจุฉ.
- `config.py`: ุฅุนุฏุงุฏุงุช ุนุงูุฉ + ุชุญููู ุงููุชุบูุฑุงุช ูู ุงูุจูุฆุฉ.
- `data/staff.csv`: ูุงุฆูุฉ ุงูุฃุฑูุงู ุงููุตุฑูุญ ููุง (Binding).
- `data/oncall.csv`: ูู ูู ุงูููุงูุจ ุงูุญุงูู ููู ูุณู (ููุญุฏุซูุง ุงููุดุฑู ูุฑุฉ ุนูุฏ ุจุฏุงูุฉ ุงูุดูุช).
- `data/updates.csv`: ุงูุชุญุฏูุซุงุช (ุงุณู ุงููุฑูุถ ุงูุซูุงุฆูุ ุงููุณูุ ุงูุญุฏุซุ ุงูููุช).
- `data/state.json`: ูุชุชุจุน ุขุฎุฑ ุชุญุฏูุซ ุชู ุฅุฑุณุงูู ูููุน ุงูุชูุฑุงุฑ.
- `.env.example`: ูููุฐุฌ ุงููุชุบูุฑุงุช ุงูุณุฑูุฉ (Twilio SID/Token/From).

---

## ๐ ุทุฑููุฉ ุงูุชุดุบูู (ูุญูููุง)
1) **ุฅูุดุงุก ุจูุฆุฉ ุจุงูุซูู** (ุงุฎุชูุงุฑู):  
```bash
python -m venv .venv && source .venv/bin/activate  # ุนูู ูููุฏูุฒ: .venv\Scripts\activate
pip install pandas python-dotenv twilio
```

2) **ูุณุฎ ููู ุงูุจูุฆุฉ** ูุชุนุจุฆุชู:
```bash
cp .env.example .env
# ุงูุชุญ .env ูุนุฏูู ุงูููู: TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_WHATSAPP_FROM
```

3) **ุญุฏูุซ ุงููููุงุช ุงูุชุงููุฉ ูุจู ุงูุชุดุบูู:**
- `data/staff.csv` : ุงูุฃุฑูุงู ุงููุตุฑูุญ ุจูุง.
- `data/oncall.csv` : ุงูููุงูุจ ููู ูุณู.
- `data/updates.csv` : ุตููู ุงูุชุญุฏูุซุงุช (ูููู ุฃู ูุตุฏูุฑูุง ุงููุฎุชุจุฑ/ุงููุจูู).

4) **ุดุบูู ุงูุจููุฑ:**
```bash
python poller.py --interval 60
```
- ุณููุฑุฃ ูู 60 ุซุงููุฉ ููุฑุณู ุฃู ุตู ุฌุฏูุฏ.
- ูุชุฌุฑุจุฉ ููุฑูุฉุ ุฃุถู ุตููุง ุฅูู `data/updates.csv` ูุดุงูุฏ ุงูุฅุฑุณุงู ูู ุงูุทุฑููุฉ.

> ููุงุญุธุฉ: ุฅุฐุง ุชุฑูุช ุญููู Twilio ูุงุฑุบุฉุ ุงูุณูุฑุจุช ุณูุทุจุน ุงูุฑุณุงุฆู ุจุฏู ุฅุฑุณุงููุง (ูุถุน ูุญุงูุงุฉ).

---

## ๐๏ธ ูููู ุงููููุงุช
```
mvp_whatsapp_bot/
  โโ poller.py
  โโ config.py
  โโ README.md
  โโ .env.example
  โโ data/
      โโ staff.csv       # ุงูุงุณู, ุงููุณู, ุงูุฑูู, ุงูุฏูุฑ, authorized
      โโ oncall.csv      # ุงููุณู, ุงูุฑูู
      โโ updates.csv     # patient_name, department, event, timestamp
      โโ state.json      # { "last_ts": "..." , "last_row": 0 }
```

---

## ๐ก๏ธ ุงูุฎุตูุตูุฉ
- ุงูุฑุณุงุฆู ุชุญุชูู **ุงุณู ุซูุงุฆู + ุงููุณู + ุงูุญุฏุซ** ููุท.
- ูุง ุชูุฑุณู ุฅูุง ููุฃุฑูุงู ุงูููุฌูุฏุฉ ูู `staff.csv` ูุงููุทุงุจูุฉ ูู `oncall.csv`.
- **ูุง ุจูุงูุงุช ุทุจูุฉ ุญุณุงุณุฉ** ุฏุงุฎู ูุต ุงูุฑุณุงูุฉ.

---

## ๐ ุชุดุบูู ูู ุฎุฏูุฉ/ูุฑูู
### ูุฑูู ุนูู ููููุณ:
ุงูุชุญ crontab:
```
crontab -e
```
ุฃุถู:
```
*/5 * * * * /usr/bin/env bash -lc 'cd /path/to/mvp_whatsapp_bot && source .venv/bin/activate && python poller.py --interval 0 --run-once'
```
> ูุฐุง ูุดุบูู ุงูุณูุฑุจุช ูุฑุฉ ูู 5 ุฏูุงุฆู (ุจุฏูู sleep ุฏุงุฎู ุงูุณูุฑุจุช).

---

## ๐ง ุงุณุชุจุฏุงู Twilio ุจู Meta Cloud (ูุงุญููุง)
- ุนุฏูู ุฏุงูุฉ ุงูุฅุฑุณุงู ูู `poller.py` ูุชุณุชุฎุฏู `requests.post` ุฅูู Meta Cloud Graph API.
- ุญุงูุธ ุนูู ููุณ ุงููุงุฌูุฉ: `send_whatsapp(to, text)`.

---

## ๐งช ุงุฎุชุจุงุฑ ุณุฑูุน
- ุชุฃูุฏ ุฃู `data/staff.csv` ูุญุชูู ุฑููู ูุน authorized=1.
- ุถุน ุฑููู ูู on-call ูู `data/oncall.csv` ููุณู (ูุซูุงู "ุงูุจุงุทูุฉ").
- ุฃุถู ุตููุง ูู `data/updates.csv` ุจูุณู "ุงูุจุงุทูุฉ" ูุงุณู "ูุญูุฏ ุฃุญูุฏ" ูุงูุญุฏุซ "ูุชูุฌุฉ ุงูุชุญููู ุฌุงูุฒุฉ" ูุชุงุฑูุฎ ุงูุขู.
- ุดุบูู: `python poller.py --interval 0 --run-once`
- ุฅุฐุง ุฅุนุฏุงุฏ Twilio ุตุญูุญ โ ุณุชุตูู ุฑุณุงูุฉ ูุงุชุณุงุจ. ุฅุฐุง ูุง โ ุณุชุฑุงูุง ูุทุจูุนุฉ ูู ุงูุทุฑููุฉ (ูุญุงูุงุฉ).

ุจุงูุชูููู!
